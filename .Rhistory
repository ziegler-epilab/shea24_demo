separate(series, into = c("category","group"), sep =" - ") %>%
ggplot(aes(x = as.factor(year_name), y = value, group = c(group, col),linetype = category, col = group,)) + geom_line(lwd =1) +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
facet_wrap(vars(cat)) +
labs(title = "C.difficile Infection by Year", y = "Case rates (cases per 100,000)", x = "Year")
dat_cdiff_cat_plot
library(tidyr)
library(gghighlight)
dat_cdiff_cat_plot <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_CDI_20240214.csv") %>%
janitor::clean_names() %>%
filter(topic =="Case rates (cases per 100,000)") %>%
mutate(cat = case_when(
grepl("HA|CA", series) ==TRUE & grepl("years", series) ==TRUE  ~ "age",
grepl("Male|Female", series) ==TRUE & grepl("HA|CA", series) ==TRUE  ~ "sex",
grepl("White|Non-white", series) ==TRUE & grepl("HA|CA", series) ==TRUE ~ "race")) %>%
filter(!is.na(cat)) %>%
separate(series, into = c("category","group"), sep =" - ") %>%
ggplot(aes(x = as.factor(year_name), y = value, group = c(group, category),linetype = category, col = group,)) + geom_line(lwd =1) +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
facet_wrap(vars(cat)) +
labs(title = "C.difficile Infection by Year", y = "Case rates (cases per 100,000)", x = "Year")
dat_cdiff_cat_plot
library(tidyr)
library(gghighlight)
dat_cdiff_cat_plot <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_CDI_20240214.csv") %>%
janitor::clean_names() %>%
filter(topic =="Case rates (cases per 100,000)") %>%
mutate(cat = case_when(
grepl("HA|CA", series) ==TRUE & grepl("years", series) ==TRUE  ~ "age",
grepl("Male|Female", series) ==TRUE & grepl("HA|CA", series) ==TRUE  ~ "sex",
grepl("White|Non-white", series) ==TRUE & grepl("HA|CA", series) ==TRUE ~ "race")) %>%
filter(!is.na(cat)) %>%
separate(series, into = c("category","group"), sep =" - ") %>%
ggplot(aes(x = as.factor(year_name), y = value, group = interaction(group, category),linetype = category, col = group,)) + geom_line(lwd =1) +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
facet_wrap(vars(cat)) +
labs(title = "C.difficile Infection by Year", y = "Case rates (cases per 100,000)", x = "Year")
dat_cdiff_cat_plot
dat_mdrgn <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_MuGSI_20240330.csv") %>%
janitor::clean_names() %>%
mutate(keep = case_when(
viewby =="Organism" & series != "All cases"  ~ 1,
organism =="CRAB" & viewby == "All cases" & topic =="Case Rates" ~ 1,
TRUE ~ 0
)) %>%
filter(keep ==1) %>%
mutate(series = ifelse(organism =="CRAB","Acinetobacter baumanii", series))
dat_mdrgn_plot <- dat_mdrgn %>%
ggplot(aes(x = as.factor(year_name), y = value, group = series)) + geom_line(aes(linetype = series)) +
#gghighlight(value > 200) +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
labs(title = "Cases by year - Carbapenem-Resistant GNB", y = "Cases per 1000 individuals", x = "Year") +
gghighlight(series =="Acinetobacter baumanii")
dat_mdrgn_plot
library(magick)
library(gganimate)
library(maps)
library(tidyr)
respi <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/Outpatient_Respiratory_Illness_Activity_Map_20240401.csv") %>%
janitor::clean_names() %>%
mutate(region = tolower(state)) %>%
separate(activity_level, into=c(NA, "level"), sep = " ") %>%
mutate(level = as.numeric(level)) %>%
filter(season =="2022-2023")
states <- map_data("state")
#joining datasets
region_dat_respi <- left_join(states, respi, by = "region")
gif_a <- region_dat_respi %>%
ggplot(., aes(long, lat, group = group)) +
geom_polygon(aes(fill = level),
colour = alpha("white", 1/2), size = 0.05)  +
geom_polygon(data = states, colour = "black", fill = NA) +
scale_fill_gradientn(colours = terrain.colors(6))  +
theme_void() +
transition_time(week) +
labs(title = 'Respiratory Infection Activity 22-23 Season: Week {frame_time}')
gif_a <- animate(gif_a, width = 300, height = 240)
gif_b <- region_dat_respi %>%
#filter(!is.na(value)) %>%
ggplot(data = ., aes(y = level)) + geom_boxplot() +
labs(x = "", title = "National Value") +
theme(axis.text.x = element_blank()) +
transition_time(week)
#enter_fade() +
#exit_shrink() +
#ease_aes('sine-in-out')
gif_b <- animate(gif_b, width = 300, height = 240)
a_mgif <- image_read(gif_a)
b_mgif <- image_read(gif_b)
new_gif <- image_append(c(a_mgif[1], b_mgif[1]))
for(i in 1:95){
combined <- image_append(c(a_mgif[i], b_mgif[i]))
new_gif <- c(new_gif, combined)
}
new_gif
library(gtsummary)
library(marginaleffects)
latitude_by_states <- states %>%
group_by(region) %>%
summarise(mean_lat = mean(lat))
vaccination <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/Vaccination_Coverage_among_Health_Care_Personnel_20240401.csv") %>%
janitor::clean_names() %>%
mutate(year = as.numeric(substr(season,1,4))) %>%
mutate(region = tolower(geography)) %>%
left_join(latitude_by_states, by = "region") %>%
rename(latitude = mean_lat) %>%
filter(personnel_type != "All Health Care Personnel")
model <- lm(estimate ~ year + latitude + personnel_type, dat = vaccination)
tbl_regression(model)
#can we plot the model estimates for year adjusted for latitude and personnel_type?
plot_predictions(model, condition = "year") +
labs(y = "Estimated Proportion: Vaccine Compliance", x= "Year", title = "Estimated Vaccine Compliance by Year")
plot_predictions(model, condition = "year") +
labs(y = "Estimated Proportion: Vaccine Compliance", x= "Year", title = "Estimated Vaccine Compliance by Year") +
theme_minimal()
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE, dpi=300, tidy=TRUE)
library(dplyr)
library(ggplot2)
library(gt)
library(dplyr)
library(ggplot2)
library(gt)
dat_cdiff <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_CDI_20240214.csv") %>%
janitor::clean_names() %>%
filter(topic =="Case rates (cases per 100,000)",
series =="Community-associated"|series=="Healthcare-associated")
head(dat_cdiff)
dat_cdiff_line_plot <- dat_cdiff %>%
ggplot(aes(x = as.factor(year_name), y = value, group = series)) + geom_line(aes(linetype = series)) +
labs(title = "Cases by year", y = "CDI cases per 1000 individuals", x = "Year")
dat_cdiff_line_plot
dat_cdiff %>%
ggplot(aes(x = as.factor(year_name), y = value, fill= series)) +
geom_col(position = "dodge") +
labs(title = "Cases by year", y = "CDI cases per 1000 individuals", x = "Year")
library(tidyr)
dat_cdiff_cat_plot <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_CDI_20240214.csv") %>%
janitor::clean_names() %>%
filter(topic =="Case rates (cases per 100,000)") %>%
mutate(cat = case_when(
grepl("HA|CA", series) ==TRUE & grepl("years", series) ==TRUE  ~ "age",
grepl("Male|Female", series) ==TRUE & grepl("HA|CA", series) ==TRUE  ~ "sex",
grepl("White|Non-white", series) ==TRUE & grepl("HA|CA", series) ==TRUE ~ "race")) %>%
filter(!is.na(cat)) %>%
separate(series, into = c("category","group"), sep =" - ") %>%
ggplot(aes(x = as.factor(year_name), y = value, group = interaction(group, category),linetype = category, col = group,)) + geom_line(lwd =1) +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
facet_wrap(vars(cat)) +
labs(title = "C.difficile Infection by Year", y = "Case rates (cases per 100,000)", x = "Year") +
theme_minimal()
dat_cdiff_cat_plot
library(tidyr)
dat_cdiff_cat_plot <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_CDI_20240214.csv") %>%
janitor::clean_names() %>%
filter(topic =="Case rates (cases per 100,000)") %>%
mutate(cat = case_when(
grepl("HA|CA", series) ==TRUE & grepl("years", series) ==TRUE  ~ "age",
grepl("Male|Female", series) ==TRUE & grepl("HA|CA", series) ==TRUE  ~ "sex",
grepl("White|Non-white", series) ==TRUE & grepl("HA|CA", series) ==TRUE ~ "race")) %>%
filter(!is.na(cat)) %>%
separate(series, into = c("category","group"), sep =" - ") %>%
ggplot(aes(x = as.factor(year_name), y = value, group = interaction(group, category),linetype = category, col = group,)) + geom_line(lwd =1) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
facet_wrap(vars(cat)) +
labs(title = "C.difficile Infection by Year", y = "Case rates (cases per 100,000)", x = "Year")
dat_cdiff_cat_plot
dat_mdrgn <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_MuGSI_20240330.csv") %>%
janitor::clean_names() %>%
mutate(keep = case_when(
viewby =="Organism" & series != "All cases"  ~ 1,
organism =="CRAB" & viewby == "All cases" & topic =="Case Rates" ~ 1,
TRUE ~ 0
)) %>%
filter(keep ==1) %>%
mutate(series = ifelse(organism =="CRAB","Acinetobacter baumanii", series))
dat_mdrgn_plot <- dat_mdrgn %>%
ggplot(aes(x = as.factor(year_name), y = value, group = series)) + geom_line(aes(linetype = series)) +
#gghighlight(value > 200) +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
labs(title = "Cases by year - Carbapenem-Resistant GNB", y = "Cases per 1000 individuals", x = "Year") +
gghighlight(series =="Acinetobacter baumanii") +
theme_minimal()
dat_mdrgn_plot
library(magick)
library(gganimate)
library(maps)
library(tidyr)
respi <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/Outpatient_Respiratory_Illness_Activity_Map_20240401.csv") %>%
janitor::clean_names() %>%
mutate(region = tolower(state)) %>%
separate(activity_level, into=c(NA, "level"), sep = " ") %>%
mutate(level = as.numeric(level)) %>%
filter(season =="2022-2023")
states <- map_data("state")
#joining datasets
region_dat_respi <- left_join(states, respi, by = "region")
gif_a <- region_dat_respi %>%
ggplot(., aes(long, lat, group = group)) +
geom_polygon(aes(fill = level),
colour = alpha("white", 1/2), size = 0.05)  +
geom_polygon(data = states, colour = "black", fill = NA) +
scale_fill_gradientn(colours = terrain.colors(6))  +
theme_void() +
transition_time(week) +
labs(title = 'Respiratory Infection Activity 22-23 Season: Week {frame_time}') +
theme_minimal()
gif_a <- animate(gif_a, width = 300, height = 240)
gif_b <- region_dat_respi %>%
#filter(!is.na(value)) %>%
ggplot(data = ., aes(y = level)) + geom_boxplot() +
labs(x = "", title = "National Value") +
theme(axis.text.x = element_blank()) +
transition_time(week)
#enter_fade() +
#exit_shrink() +
#ease_aes('sine-in-out')
gif_b <- animate(gif_b, width = 300, height = 240)
a_mgif <- image_read(gif_a)
b_mgif <- image_read(gif_b)
new_gif <- image_append(c(a_mgif[1], b_mgif[1]))
for(i in 1:95){
combined <- image_append(c(a_mgif[i], b_mgif[i]))
new_gif <- c(new_gif, combined)
}
new_gif
new_gif
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE, dpi=300, tidy=TRUE)
library(dplyr)
library(ggplot2)
library(gt)
dat_cdiff <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_CDI_20240214.csv") %>%
janitor::clean_names() %>%
filter(topic =="Case rates (cases per 100,000)",
series =="Community-associated"|series=="Healthcare-associated")
head(dat_cdiff)
dat_cdiff_line_plot <- dat_cdiff %>%
ggplot(aes(x = as.factor(year_name), y = value, group = series)) + geom_line(aes(linetype = series)) +
labs(title = "Cases by year", y = "CDI cases per 1000 individuals", x = "Year")
dat_cdiff_line_plot
dat_cdiff %>%
ggplot(aes(x = as.factor(year_name), y = value, fill= series)) +
geom_col(position = "dodge") +
labs(title = "Cases by year", y = "CDI cases per 1000 individuals", x = "Year")
library(tidyr)
dat_cdiff_cat_plot <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_CDI_20240214.csv") %>%
janitor::clean_names() %>%
filter(topic =="Case rates (cases per 100,000)") %>%
mutate(cat = case_when(
grepl("HA|CA", series) ==TRUE & grepl("years", series) ==TRUE  ~ "age",
grepl("Male|Female", series) ==TRUE & grepl("HA|CA", series) ==TRUE  ~ "sex",
grepl("White|Non-white", series) ==TRUE & grepl("HA|CA", series) ==TRUE ~ "race")) %>%
filter(!is.na(cat)) %>%
separate(series, into = c("category","group"), sep =" - ") %>%
ggplot(aes(x = as.factor(year_name), y = value, group = interaction(group, category),linetype = category, col = group,)) + geom_line(lwd =1) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
facet_wrap(vars(cat)) +
labs(title = "C.difficile Infection by Year", y = "Case rates (cases per 100,000)", x = "Year")
dat_cdiff_cat_plot
dat_mdrgn <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_MuGSI_20240330.csv") %>%
janitor::clean_names() %>%
mutate(keep = case_when(
viewby =="Organism" & series != "All cases"  ~ 1,
organism =="CRAB" & viewby == "All cases" & topic =="Case Rates" ~ 1,
TRUE ~ 0
)) %>%
filter(keep ==1) %>%
mutate(series = ifelse(organism =="CRAB","Acinetobacter baumanii", series))
dat_mdrgn_plot <- dat_mdrgn %>%
ggplot(aes(x = as.factor(year_name), y = value, group = series)) + geom_line(aes(linetype = series)) +
#gghighlight(value > 200) +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
labs(title = "Cases by year - Carbapenem-Resistant GNB", y = "Cases per 1000 individuals", x = "Year") +
gghighlight(series =="Acinetobacter baumanii") +
theme_minimal()
dat_mdrgn_plot
library(magick)
library(gganimate)
library(maps)
library(tidyr)
respi <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/Outpatient_Respiratory_Illness_Activity_Map_20240401.csv") %>%
janitor::clean_names() %>%
mutate(region = tolower(state)) %>%
separate(activity_level, into=c(NA, "level"), sep = " ") %>%
mutate(level = as.numeric(level)) %>%
filter(season =="2022-2023")
states <- map_data("state")
#joining datasets
region_dat_respi <- left_join(states, respi, by = "region")
gif_a <- region_dat_respi %>%
ggplot(., aes(long, lat, group = group)) +
geom_polygon(aes(fill = level),
colour = alpha("white", 1/2), size = 0.05)  +
geom_polygon(data = states, colour = "black", fill = NA) +
scale_fill_gradientn(colours = terrain.colors(6))  +
theme_void() +
transition_time(week) +
labs(title = 'Respiratory Infection Activity 22-23 Season: Week {frame_time}') +
theme_minimal()
gif_a <- animate(gif_a, width = 300, height = 240)
gif_b <- region_dat_respi %>%
#filter(!is.na(value)) %>%
ggplot(data = ., aes(y = level)) + geom_boxplot() +
labs(x = "", title = "National Value") +
theme(axis.text.x = element_blank()) +
transition_time(week)
#enter_fade() +
#exit_shrink() +
#ease_aes('sine-in-out')
gif_b <- animate(gif_b, width = 300, height = 240)
a_mgif <- image_read(gif_a)
b_mgif <- image_read(gif_b)
new_gif <- image_append(c(a_mgif[1], b_mgif[1]))
for(i in 1:95){
combined <- image_append(c(a_mgif[i], b_mgif[i]))
new_gif <- c(new_gif, combined)
}
new_gif
library(gtsummary)
library(marginaleffects)
latitude_by_states <- states %>%
group_by(region) %>%
summarise(mean_lat = mean(lat))
vaccination <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/Vaccination_Coverage_among_Health_Care_Personnel_20240401.csv") %>%
janitor::clean_names() %>%
mutate(year = as.numeric(substr(season,1,4))) %>%
mutate(region = tolower(geography)) %>%
left_join(latitude_by_states, by = "region") %>%
rename(latitude = mean_lat) %>%
filter(personnel_type != "All Health Care Personnel")
model <- lm(estimate ~ year + latitude + personnel_type, dat = vaccination)
tbl_regression(model)
#can we plot the model estimates for year adjusted for latitude and personnel_type?
plot_predictions(model, condition = "year") +
labs(y = "Estimated Proportion: Vaccine Compliance", x= "Year", title = "Estimated Vaccine Compliance by Year") +
theme_minimal()
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE, dpi=300, tidy=TRUE)
library(dplyr)
library(ggplot2)
library(gt)
dat_cdiff <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_CDI_20240214.csv") %>%
janitor::clean_names() %>%
filter(topic =="Case rates (cases per 100,000)",
series =="Community-associated"|series=="Healthcare-associated")
head(dat_cdiff)
dat_cdiff_line_plot <- dat_cdiff %>%
ggplot(aes(x = as.factor(year_name), y = value, group = series)) + geom_line(aes(linetype = series)) +
labs(title = "Cases by year", y = "CDI cases per 1000 individuals", x = "Year")
dat_cdiff_line_plot
library(tidyr)
dat_cdiff_cat_plot <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_CDI_20240214.csv") %>%
janitor::clean_names() %>%
filter(topic =="Case rates (cases per 100,000)") %>%
mutate(cat = case_when(
grepl("HA|CA", series) ==TRUE & grepl("years", series) ==TRUE  ~ "age",
grepl("Male|Female", series) ==TRUE & grepl("HA|CA", series) ==TRUE  ~ "sex",
grepl("White|Non-white", series) ==TRUE & grepl("HA|CA", series) ==TRUE ~ "race")) %>%
filter(!is.na(cat)) %>%
separate(series, into = c("category","group"), sep =" - ") %>%
ggplot(aes(x = as.factor(year_name), y = value, group = interaction(group, category),linetype = category, col = group,)) + geom_line(lwd =1) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
facet_wrap(vars(cat)) +
labs(title = "C.difficile Infection by Year", y = "Case rates (cases per 100,000)", x = "Year")
dat_cdiff_cat_plot
dat_mdrgn <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_MuGSI_20240330.csv") %>%
janitor::clean_names() %>%
mutate(keep = case_when(
viewby =="Organism" & series != "All cases"  ~ 1,
organism =="CRAB" & viewby == "All cases" & topic =="Case Rates" ~ 1,
TRUE ~ 0
)) %>%
filter(keep ==1) %>%
mutate(series = ifelse(organism =="CRAB","Acinetobacter baumanii", series))
dat_mdrgn_plot <- dat_mdrgn %>%
ggplot(aes(x = as.factor(year_name), y = value, group = series)) + geom_line(aes(linetype = series)) +
#gghighlight(value > 200) +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
labs(title = "Cases by year - Carbapenem-Resistant GNB", y = "Cases per 1000 individuals", x = "Year") +
gghighlight(series =="Acinetobacter baumanii") +
theme_minimal()
library(gghighlight)
dat_mdrgn <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/HAICViz_-_MuGSI_20240330.csv") %>%
janitor::clean_names() %>%
mutate(keep = case_when(
viewby =="Organism" & series != "All cases"  ~ 1,
organism =="CRAB" & viewby == "All cases" & topic =="Case Rates" ~ 1,
TRUE ~ 0
)) %>%
filter(keep ==1) %>%
mutate(series = ifelse(organism =="CRAB","Acinetobacter baumanii", series))
dat_mdrgn_plot <- dat_mdrgn %>%
ggplot(aes(x = as.factor(year_name), y = value, group = series)) + geom_line(aes(linetype = series)) +
#gghighlight(value > 200) +
theme(axis.text.x = element_text(angle = 75, vjust = 0, hjust=0)) +
labs(title = "Cases by year - Carbapenem-Resistant GNB", y = "Cases per 1000 individuals", x = "Year") +
gghighlight(series =="Acinetobacter baumanii") +
theme_minimal()
dat_mdrgn_plot
library(magick)
library(gganimate)
library(maps)
library(tidyr)
respi <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/Outpatient_Respiratory_Illness_Activity_Map_20240401.csv") %>%
janitor::clean_names() %>%
mutate(region = tolower(state)) %>%
separate(activity_level, into=c(NA, "level"), sep = " ") %>%
mutate(level = as.numeric(level)) %>%
filter(season =="2022-2023")
states <- map_data("state")
#joining datasets
region_dat_respi <- left_join(states, respi, by = "region")
gif_a <- region_dat_respi %>%
ggplot(., aes(long, lat, group = group)) +
geom_polygon(aes(fill = level),
colour = alpha("white", 1/2), size = 0.05)  +
geom_polygon(data = states, colour = "black", fill = NA) +
scale_fill_gradientn(colours = terrain.colors(6))  +
theme_void() +
transition_time(week) +
labs(title = 'Respiratory Infection Activity 22-23 Season: Week {frame_time}') +
theme_minimal()
gif_a <- animate(gif_a, width = 300, height = 240)
gif_b <- region_dat_respi %>%
#filter(!is.na(value)) %>%
ggplot(data = ., aes(y = level)) + geom_boxplot() +
labs(x = "", title = "National Value") +
theme(axis.text.x = element_blank()) +
transition_time(week)
#enter_fade() +
#exit_shrink() +
#ease_aes('sine-in-out')
gif_b <- animate(gif_b, width = 300, height = 240)
a_mgif <- image_read(gif_a)
b_mgif <- image_read(gif_b)
new_gif <- image_append(c(a_mgif[1], b_mgif[1]))
for(i in 1:95){
combined <- image_append(c(a_mgif[i], b_mgif[i]))
new_gif <- c(new_gif, combined)
}
new_gif
library(gtsummary)
library(marginaleffects)
latitude_by_states <- states %>%
group_by(region) %>%
summarise(mean_lat = mean(lat))
vaccination <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/Vaccination_Coverage_among_Health_Care_Personnel_20240401.csv") %>%
janitor::clean_names() %>%
mutate(year = as.numeric(substr(season,1,4))) %>%
mutate(region = tolower(geography)) %>%
left_join(latitude_by_states, by = "region") %>%
rename(latitude = mean_lat) %>%
filter(personnel_type != "All Health Care Personnel")
model <- lm(estimate ~ year + latitude + personnel_type, dat = vaccination)
tbl_regression(model)
#can we plot the model estimates for year adjusted for latitude and personnel_type?
plot_predictions(model, condition = "year") +
labs(y = "Estimated Proportion: Vaccine Compliance", x= "Year", title = "Estimated Vaccine Compliance by Year") +
theme_minimal()
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE, dpi=300, tidy=FALSE)
library(magick)
library(gganimate)
library(maps)
library(tidyr)
respi <- read.csv("/Users/mattz/Documents/GitHub/shea24_demo/Outpatient_Respiratory_Illness_Activity_Map_20240401.csv") %>%
janitor::clean_names() %>%
mutate(region = tolower(state)) %>%
separate(activity_level, into=c(NA, "level"), sep = " ") %>%
mutate(level = as.numeric(level)) %>%
filter(season =="2022-2023")
states <- map_data("state")
#joining datasets
region_dat_respi <- left_join(states, respi, by = "region")
gif_a <- region_dat_respi %>%
ggplot(., aes(long, lat, group = group)) +
geom_polygon(aes(fill = level),
colour = alpha("white", 1/2), size = 0.05)  +
geom_polygon(data = states, colour = "black", fill = NA) +
scale_fill_gradientn(colours = terrain.colors(6))  +
theme_void() +
transition_time(week) +
labs(title = 'Respiratory Infection Activity 22-23 Season: Week {frame_time}') +
theme_minimal()
gif_a <- animate(gif_a, width = 350, height = 240)
gif_b <- region_dat_respi %>%
#filter(!is.na(value)) %>%
ggplot(data = ., aes(y = level)) + geom_boxplot() +
labs(x = "", title = "National Value") +
theme(axis.text.x = element_blank()) +
transition_time(week)
#enter_fade() +
#exit_shrink() +
#ease_aes('sine-in-out')
gif_b <- animate(gif_b, width = 300, height = 240)
a_mgif <- image_read(gif_a)
b_mgif <- image_read(gif_b)
new_gif <- image_append(c(a_mgif[1], b_mgif[1]))
for(i in 1:95){
combined <- image_append(c(a_mgif[i], b_mgif[i]))
new_gif <- c(new_gif, combined)
}
new_gif
install.packages("TidyR")
install.packages("formatR")
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE, tidy=TRUE)
new_gif
new_gif
new_gif
new_gif
new_gif
new_gif
